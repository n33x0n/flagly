const T=new Set(["pl","de","fr","gb","it","es","pt","nl","be","at","ch","cz","sk","hu","ro","bg","hr","si","rs","ua","ru","by","lt","lv","ee","fi","se","no","dk","is","ie","gr","tr","cy","mt","us","ca","mx","br","ar","cl","co","pe","cn","jp","kr","in","au","nz","eg","za","ma","ng","ke","il","sa","ae","th","vn","id"]),A=new Set(["al","ba","me","mk","xk","md","ge","am","az","kz","uz","tm","tj","kg","mn","pk","bd","lk","np","mm","kh","la","ph","my","sg","tw","hk","mo","iq","ir","sy","jo","lb","kw","qa","bh","om","ye","af","et","tz","ug","rw","sd","dz","tn","ly","gh","ci","sn","cm","cd","ao","mz","zw","bw","na","cu","jm","ht","do","pr","pa","cr","ve","ec","bo","py","uy","fj"]),W={ad:"Andora",ae:"Zjednoczone Emiraty Arabskie",af:"Afganistan",ag:"Antigua i Barbuda",ai:"Anguilla",al:"Albania",am:"Armenia",ao:"Angola",aq:"Antarktyka",ar:"Argentyna",as:"Samoa AmerykaÅ„skie",at:"Austria",au:"Australia",aw:"Aruba",ax:"Wyspy Alandzkie",az:"AzerbejdÅ¼an",ba:"BoÅ›nia i Hercegowina",bb:"Barbados",bd:"Bangladesz",be:"Belgia",bf:"Burkina Faso",bg:"BuÅ‚garia",bh:"Bahrajn",bi:"Burundi",bj:"Benin",bl:"Saint-BarthÃ©lemy",bm:"Bermudy",bn:"Brunei",bo:"Boliwia",bq:"Holandia Karaibska",br:"Brazylia",bs:"Bahamy",bt:"Bhutan",bv:"Wyspa Bouveta",bw:"Botswana",by:"BiaÅ‚oruÅ›",bz:"Belize",ca:"Kanada",cc:"Wyspy Kokosowe",cd:"Demokratyczna Republika Konga",cf:"Republika ÅšrodkowoafrykaÅ„ska",cg:"Kongo",ch:"Szwajcaria",ci:"WybrzeÅ¼e KoÅ›ci SÅ‚oniowej",ck:"Wyspy Cooka",cl:"Chile",cm:"Kamerun",cn:"Chiny",co:"Kolumbia",cr:"Kostaryka",cu:"Kuba",cv:"Republika Zielonego PrzylÄ…dka",cw:"CuraÃ§ao",cx:"Wyspa BoÅ¼ego Narodzenia",cy:"Cypr",cz:"Czechy",de:"Niemcy",dj:"DÅ¼ibuti",dk:"Dania",dm:"Dominika",do:"Dominikana",dz:"Algieria",ec:"Ekwador",ee:"Estonia",eg:"Egipt",eh:"Sahara Zachodnia",er:"Erytrea",es:"Hiszpania",et:"Etiopia",fi:"Finlandia",fj:"FidÅ¼i",fk:"Falklandy",fm:"Mikronezja",fo:"Wyspy Owcze",fr:"Francja",ga:"Gabon",gb:"Wielka Brytania",gd:"Grenada",ge:"Gruzja",gf:"Gujana Francuska",gg:"Guernsey",gh:"Ghana",gi:"Gibraltar",gl:"Grenlandia",gm:"Gambia",gn:"Gwinea",gp:"Gwadelupa",gq:"Gwinea RÃ³wnikowa",gr:"Grecja",gs:"Georgia PoÅ‚udniowa i Sandwich PoÅ‚udniowy",gt:"Gwatemala",gu:"Guam",gw:"Gwinea Bissau",gy:"Gujana",hk:"Hongkong",hm:"Wyspy Heard i McDonalda",hn:"Honduras",hr:"Chorwacja",ht:"Haiti",hu:"WÄ™gry",id:"Indonezja",ie:"Irlandia",il:"Izrael",im:"Wyspa Man",in:"Indie",io:"Brytyjskie Terytorium Oceanu Indyjskiego",iq:"Irak",ir:"Iran",is:"Islandia",it:"WÅ‚ochy",je:"Jersey",jm:"Jamajka",jo:"Jordania",jp:"Japonia",ke:"Kenia",kg:"Kirgistan",kh:"KambodÅ¼a",ki:"Kiribati",km:"Komory",kn:"Saint Kitts i Nevis",kp:"Korea PÃ³Å‚nocna",kr:"Korea PoÅ‚udniowa",kw:"Kuwejt",ky:"Kajmany",kz:"Kazachstan",la:"Laos",lb:"Liban",lc:"Saint Lucia",li:"Liechtenstein",lk:"Sri Lanka",lr:"Liberia",ls:"Lesotho",lt:"Litwa",lu:"Luksemburg",lv:"Åotwa",ly:"Libia",ma:"Maroko",mc:"Monako",md:"MoÅ‚dawia",me:"CzarnogÃ³ra",mf:"Saint-Martin",mg:"Madagaskar",mh:"Wyspy Marshalla",mk:"Macedonia PÃ³Å‚nocna",ml:"Mali",mm:"Mjanma",mn:"Mongolia",mo:"Makau",mp:"Mariany PÃ³Å‚nocne",mq:"Martynika",mr:"Mauretania",ms:"Montserrat",mt:"Malta",mu:"Mauritius",mv:"Malediwy",mw:"Malawi",mx:"Meksyk",my:"Malezja",mz:"Mozambik",na:"Namibia",nc:"Nowa Kaledonia",ne:"Niger",nf:"Wyspa Norfolk",ng:"Nigeria",ni:"Nikaragua",nl:"Holandia",no:"Norwegia",np:"Nepal",nr:"Nauru",nu:"Niue",nz:"Nowa Zelandia",om:"Oman",pa:"Panama",pe:"Peru",pf:"Polinezja Francuska",pg:"Papua-Nowa Gwinea",ph:"Filipiny",pk:"Pakistan",pl:"Polska",pm:"Saint-Pierre i Miquelon",pn:"Pitcairn",pr:"Portoryko",ps:"Palestyna",pt:"Portugalia",pw:"Palau",py:"Paragwaj",qa:"Katar",re:"Reunion",ro:"Rumunia",rs:"Serbia",ru:"Rosja",rw:"Rwanda",sa:"Arabia Saudyjska",sb:"Wyspy Salomona",sc:"Seszele",sd:"Sudan",se:"Szwecja",sg:"Singapur",sh:"Wyspa ÅšwiÄ™tej Heleny",si:"SÅ‚owenia",sj:"Svalbard i Jan Mayen",sk:"SÅ‚owacja",sl:"Sierra Leone",sm:"San Marino",sn:"Senegal",so:"Somalia",sr:"Surinam",ss:"Sudan PoÅ‚udniowy",st:"Wyspy ÅšwiÄ™tego Tomasza i KsiÄ…Å¼Ä™ca",sv:"Salwador",sx:"Sint Maarten",sy:"Syria",sz:"Suazi",tc:"Turks i Caicos",td:"Czad",tf:"Francuskie Terytoria PoÅ‚udniowe",tg:"Togo",th:"Tajlandia",tj:"TadÅ¼ykistan",tk:"Tokelau",tl:"Timor Wschodni",tm:"Turkmenistan",tn:"Tunezja",to:"Tonga",tr:"Turcja",tt:"Trynidad i Tobago",tv:"Tuvalu",tw:"Tajwan",tz:"Tanzania",ua:"Ukraina",ug:"Uganda",um:"Dalekie Wyspy Mniejsze USA",us:"Stany Zjednoczone",uy:"Urugwaj",uz:"Uzbekistan",va:"Watykan",vc:"Saint Vincent i Grenadyny",ve:"Wenezuela",vg:"Brytyjskie Wyspy Dziewicze",vi:"Wyspy Dziewicze USA",vn:"Wietnam",vu:"Vanuatu",wf:"Wallis i Futuna",ws:"Samoa",xk:"Kosowo",ye:"Jemen",yt:"Majotta",za:"PoÅ‚udniowa Afryka",zm:"Zambia",zw:"Zimbabwe"};function K(t){return T.has(t)?"easy":A.has(t)?"medium":"hard"}const g=Object.entries(W).map(([t,e])=>({code:t,name:e,difficulty:K(t)}));function N(t){return g.filter(e=>e.difficulty===t)}function E(t){switch(t){case"easy":return N("easy");case"medium":return g.filter(e=>e.difficulty==="easy"||e.difficulty==="medium");case"hard":return g}}function q(t,e){return[...t].sort(()=>Math.random()-.5).slice(0,e)}function D(t,e){const n=e.filter(o=>o.code!==t.code).sort(()=>Math.random()-.5).slice(0,2);return[t,...n].sort(()=>Math.random()-.5)}function $(t){return`https://flagcdn.com/${t}.svg`}const z="flagly_stats";function b(){if(typeof window>"u")return{players:{},lastPlayer:null};try{const t=localStorage.getItem(z);if(t)return JSON.parse(t)}catch(t){console.error("Error reading localStorage:",t)}return{players:{},lastPlayer:null}}function F(t){if(!(typeof window>"u"))try{localStorage.setItem(z,JSON.stringify(t))}catch(e){console.error("Error saving to localStorage:",e)}}function H(t,e){const n=b();n.players[t]||(n.players[t]={gamesPlayed:0,bestScore:0,totalCorrect:0,totalQuestions:0,history:[]});const a=n.players[t],o={...e,date:new Date().toISOString()};a.gamesPlayed++,a.totalCorrect+=e.score,a.totalQuestions+=e.total,a.bestScore=Math.max(a.bestScore,e.score),a.history.unshift(o),a.history.length>50&&(a.history=a.history.slice(0,50)),n.lastPlayer=t,F(n)}function I(t){return b().players[t]||null}function O(){return b().lastPlayer}let m="easy",d="",f=[],c=0,l=0,j=0,p=!1;const Q=document.getElementById("start-screen"),R=document.getElementById("quiz-screen"),J=document.getElementById("summary-screen"),Z=document.getElementById("stats-screen"),U=document.getElementById("global-stats-screen"),k=document.getElementById("player-name"),V=document.querySelectorAll(".difficulty-btn"),_=document.getElementById("question-counter"),Y=document.getElementById("score-counter"),X=document.getElementById("progress-fill"),S=document.getElementById("flag-image"),y=document.getElementById("options-container"),tt=document.getElementById("play-again-btn"),et=document.getElementById("change-difficulty-btn"),at=document.getElementById("show-stats-btn"),nt=document.getElementById("show-global-stats-btn"),ot=document.getElementById("close-stats-btn"),st=document.getElementById("close-global-stats-btn"),it=document.getElementById("back-to-menu-btn"),rt=document.getElementById("back-to-menu-global-btn"),lt=document.getElementById("quit-quiz-btn"),h=()=>`${window.location.pathname.includes("/flagly/")?"/flagly":""}/api/stats.php`;async function ct(t,e,n,a){try{const o=await fetch(h(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:t,total:e,difficulty:n,playerName:a})});return o.ok?{success:!0}:{success:!1,error:(await o.json().catch(()=>({}))).error||"Server Error"}}catch(o){return console.error("Failed to update global stats",o),{success:!1,error:"Network Error"}}}async function dt(){try{document.getElementById("global-stats-content").style.opacity="0.5",document.getElementById("global-stats-error").style.display="none";const t=await fetch(h());if(!t.ok)throw new Error("Network response was not ok");const e=await t.json();document.getElementById("global-games").textContent=(e.totalGames||0).toLocaleString(),document.getElementById("global-games-easy").textContent=(e.gamesModes?.easy||0).toLocaleString(),document.getElementById("global-games-medium").textContent=(e.gamesModes?.medium||0).toLocaleString(),document.getElementById("global-games-hard").textContent=(e.gamesModes?.hard||0).toLocaleString();const n=e.bestScores?.easy||0,a=e.bestScores?.medium||0,o=e.bestScores?.hard||0,i=Math.max(n,a,o);document.getElementById("global-best-all").textContent=i.toString(),document.getElementById("global-best-easy").textContent=n.toString(),document.getElementById("global-best-medium").textContent=a.toString(),document.getElementById("global-best-hard").textContent=o.toString(),document.getElementById("global-total-correct").textContent=(e.totalCorrect||0).toLocaleString();const r=e.totalQuestions||0,x=r-(e.totalCorrect||0);document.getElementById("global-total-incorrect").textContent=x.toLocaleString();const L=r>0?Math.round((e.totalCorrect||0)/r*100):0;document.getElementById("global-accuracy").textContent=`${L}%`;const w=document.getElementById("global-stats-list");e.recentGames&&e.recentGames.length>0?w.innerHTML=e.recentGames.map(u=>{const P=new Date(u.date).toLocaleDateString("pl-PL",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),G={easy:"ğŸŸ¢",medium:"ğŸŸ¡",hard:"ğŸ”´"}[u.difficulty]||"âšª";return`
						<div class="stats-item">
							<div class="stats-item-info">
								<span style="font-weight: 700; color: var(--text-primary); margin-right: 0.5rem;">${u.playerName}</span>
								<span class="stats-item-date" style="font-size: 0.75rem;">${P}</span>
							</div>
							<div style="display: flex; align-items: center; gap: 0.5rem;">
								<span style="font-size: 0.8rem;">${G}</span>
								<span class="stats-item-score">${u.score}/${u.total}</span>
							</div>
						</div>
					`}).join(""):w.innerHTML='<div class="stats-empty">Brak historii gier. Zagraj jako pierwszy!</div>',document.getElementById("global-stats-content").style.opacity="1"}catch(t){console.error("Failed to fetch global stats",t),document.getElementById("global-stats-content").style.opacity="1",document.getElementById("global-stats-error").style.display="block"}}async function C(){try{const t=await fetch(h());if(t.ok){const e=await t.json();e.gamesModes&&(document.getElementById("counter-easy").textContent=e.gamesModes.easy||"0",document.getElementById("counter-medium").textContent=e.gamesModes.medium||"0",document.getElementById("counter-hard").textContent=e.gamesModes.hard||"0")}}catch(t){console.error("Failed to fetch game counters",t)}}C();const B=O();B&&(k.value=B);V.forEach(t=>{t.addEventListener("click",()=>{d=k.value.trim()||"Gracz",m=t.dataset.difficulty,v()})});function v(){const t=E(m);f=q(t,30),c=0,l=0,j=Date.now(),s("quiz"),M()}function M(){if(c>=f.length){mt();return}p=!1;const t=f[c],e=E(m),n=D(t,e);_.textContent=`Pytanie ${c+1}/30`,Y.textContent=`Wynik: ${l}`,X.style.width=`${c/30*100}%`,S.src=$(t.code),S.alt="Flaga kraju do odgadniÄ™cia",y.innerHTML=n.map(a=>`
      <button class="btn-answer" data-code="${a.code}">
        ${a.name}
      </button>
    `).join(""),y.querySelectorAll(".btn-answer").forEach(a=>{a.addEventListener("click",()=>ut(a,t.code))})}function ut(t,e){if(p)return;p=!0,t.dataset.code===e?(l++,t.classList.add("correct")):(t.classList.add("incorrect"),y.querySelectorAll(".btn-answer").forEach(o=>{o.dataset.code===e&&o.classList.add("correct")})),y.querySelectorAll(".btn-answer").forEach(o=>{o.disabled=!0}),setTimeout(()=>{c++,M()},1e3)}function mt(){const t=Date.now(),e=Math.round((t-j)/1e3);H(d,{score:l,total:30,difficulty:m,timeSeconds:e});const n=document.getElementById("online-status");n&&(n.textContent="WysyÅ‚anie wyniku do rankingu...",n.style.color="var(--text-secondary)",ct(l,30,m,d).then(r=>{r.success?(n.textContent="Wynik zapisany w rankingu globalnym ğŸŒ",n.style.color="var(--color-success)"):(n.textContent=`BÅ‚Ä…d rankingu: ${r.error}`,n.style.color="var(--color-error)")}));const a=I(d);document.getElementById("final-score").textContent=`${l}/30`;const o=Math.round(l/30*100);document.getElementById("stat-percent").textContent=`${o}%`,document.getElementById("stat-time").textContent=`${e}s`,document.getElementById("stat-best").textContent=a?.bestScore.toString()||"0",document.getElementById("stat-games").textContent=a?.gamesPlayed.toString()||"0";let i="";o>=90?i="ğŸ† Niesamowite! JesteÅ› mistrzem flag!":o>=70?i="ğŸ‘ Åšwietny wynik! Tak trzymaj!":o>=50?i="ğŸ‘ Dobry poczÄ…tek! Ä†wicz dalej!":i="ğŸ’ª Nie poddawaj siÄ™! SprÃ³buj jeszcze raz!",document.getElementById("score-message").textContent=i,s("summary")}function yt(){d=k.value.trim()||"Gracz";const t=I(d);if(t){document.getElementById("total-games").textContent=t.gamesPlayed.toString(),document.getElementById("total-best").textContent=t.bestScore.toString(),document.getElementById("total-correct").textContent=t.totalCorrect.toString();const e=t.totalQuestions>0?Math.round(t.totalCorrect/t.totalQuestions*100):0;document.getElementById("total-accuracy").textContent=`${e}%`;const n=document.getElementById("stats-list");t.history.length>0?n.innerHTML=t.history.slice(0,10).map(a=>`
						<div class="stats-item">
							<div class="stats-item-info">
								<span class="stats-item-date">${new Date(a.date).toLocaleDateString("pl-PL",{day:"numeric",month:"short"})}</span>
								<span class="stats-item-difficulty">${{easy:"ğŸŸ¢ Åatwy",medium:"ğŸŸ¡ Åšredni",hard:"ğŸ”´ Trudny"}[a.difficulty]||a.difficulty}</span>
							</div>
							<span class="stats-item-score">${a.score}/${a.total}</span>
						</div>
					`).join(""):n.innerHTML='<div class="stats-empty">Brak historii gier</div>'}else document.getElementById("total-games").textContent="0",document.getElementById("total-best").textContent="0",document.getElementById("total-correct").textContent="0",document.getElementById("total-accuracy").textContent="0%",document.getElementById("stats-list").innerHTML='<div class="stats-empty">Zagraj swojÄ… pierwszÄ… grÄ™!</div>';s("stats")}function s(t){Q.style.display=t==="start"?"flex":"none",R.style.display=t==="quiz"?"flex":"none",J.style.display=t==="summary"?"flex":"none",Z.style.display=t==="stats"?"flex":"none",U.style.display=t==="global-stats"?"flex":"none",t==="start"&&C()}tt.addEventListener("click",()=>v());et.addEventListener("click",()=>s("start"));at.addEventListener("click",()=>yt());nt.addEventListener("click",()=>{s("global-stats"),dt()});ot.addEventListener("click",()=>s("start"));st.addEventListener("click",()=>s("start"));it.addEventListener("click",()=>s("start"));rt.addEventListener("click",()=>s("start"));lt.addEventListener("click",()=>s("start"));
